#!/sbin/sh
#
# Copyright 2006 Sun Microsystems, Inc.  All rights reserved.
# Use is subject to license terms.
#
# ident	"@(#)svc-vntsd	1.1	06/06/22 SMI"
#
# Start script for vntsd
#
# For modifying parameters passed to vntsd, do not edit
# this script. Instead use svccfg(1m) to modify the SMF
# repository. For example:
#
# svccfg
# svc:> select ldoms/vntsd
# svc:/ldoms/vntsd> setprop vntsd/vcc_device = "virtual-console-concentrator@1"
# svc:/ldoms/vntsd> setprop vntsd/listen_addr = "192.168.1.1"
# svc:/ldoms/vntsd> exit

. /lib/svc/share/smf_include.sh

vcc_device=`svcprop -p vntsd/vcc_device $SMF_FMRI 2>/dev/null`
if [ -z "$vcc_device" ]; then
	vcc_device="virtual-console-concentrator@0"
fi
args="-i $vcc_device"

listen_addr=`svcprop -p vntsd/listen_addr $SMF_FMRI 2>/dev/null`
if [ -n "$listen_addr" ]; then
	args="$args -p $listen_addr"
fi

timeout=`svcprop -p vntsd/timeout_minutes $SMF_FMRI 2>/dev/null`
if [ -n "$timeout" ]; then
	args="$args -t $timeout"
fi

if [ -x /usr/lib/ldoms/vntsd ]; then
    /usr/lib/ldoms/vntsd $args || exit $SMF_EXIT_ERR_CONFIG
else
    echo "WARNING: /usr/lib/ldoms/vntsd is missing or not executable" >& 2
    exit $SMF_EXIT_ERR_CONFIG
fi

exit $SMF_EXIT_OK
